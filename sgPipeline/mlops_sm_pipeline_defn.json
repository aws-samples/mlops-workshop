"{\n    \"Version\": \"2020-12-01\",\n    \"Metadata\": {},\n    \"Parameters\": [\n        {\n            \"Name\": \"ProcessingInstanceCount\",\n            \"Type\": \"Integer\",\n            \"DefaultValue\": 1\n        },\n        {\n            \"Name\": \"TrainingInstanceCount\",\n            \"Type\": \"Integer\",\n            \"DefaultValue\": 1\n        },\n        {\n            \"Name\": \"ModelApprovalStatus\",\n            \"Type\": \"String\",\n            \"DefaultValue\": \"Approved\"\n        },\n        {\n            \"Name\": \"MseThreshold\",\n            \"Type\": \"Float\",\n            \"DefaultValue\": 6.0\n        },\n        {\n            \"Name\": \"mlops_bucket\",\n            \"Type\": \"String\",\n            \"DefaultValue\": \"mlops-us-east-2-<AccountId>\"\n        },\n        {\n            \"Name\": \"data_bucket\",\n            \"Type\": \"String\",\n            \"DefaultValue\": \"data-us-east-2-<AccountId>\"\n        }\n    ],\n    \"PipelineExperimentConfig\": {\n        \"ExperimentName\": {\n            \"Get\": \"Execution.PipelineName\"\n        },\n        \"TrialName\": {\n            \"Get\": \"Execution.PipelineExecutionId\"\n        }\n    },\n    \"Steps\": [\n        {\n            \"Name\": \"ETL\",\n            \"Type\": \"Processing\",\n            \"Arguments\": {\n                \"ProcessingResources\": {\n                    \"ClusterConfig\": {\n                        \"InstanceType\": \"ml.m5.xlarge\",\n                        \"InstanceCount\": {\n                            \"Get\": \"Parameters.ProcessingInstanceCount\"\n                        },\n                        \"VolumeSizeInGB\": 30\n                    }\n                },\n                \"AppSpecification\": {\n                    \"ImageUri\": \"257758044811.dkr.ecr.us-east-2.amazonaws.com/sagemaker-scikit-learn:0.23-1-cpu-py3\",\n                    \"ContainerEntrypoint\": [\n                        \"python3\",\n                        \"/opt/ml/processing/input/code/preprocessing.py\"\n                    ]\n                },\n                \"RoleArn\": \"arn:aws:iam::<AccountId>:role/service-role/AmazonSageMaker-ExecutionRole-20221004T094906\",\n                \"ProcessingInputs\": [\n                    {\n                        \"InputName\": \"input-1\",\n                        \"AppManaged\": false,\n                        \"S3Input\": {\n                            \"S3Uri\": {\n                                \"Std:Join\": {\n                                    \"On\": \"/\",\n                                    \"Values\": [\n                                        \"s3:/\",\n                                        {\n                                            \"Get\": \"Parameters.data_bucket\"\n                                        },\n                                        \"input/raw/abalone.csv\"\n                                    ]\n                                }\n                            },\n                            \"LocalPath\": \"/opt/ml/processing/input\",\n                            \"S3DataType\": \"S3Prefix\",\n                            \"S3InputMode\": \"File\",\n                            \"S3DataDistributionType\": \"FullyReplicated\",\n                            \"S3CompressionType\": \"None\"\n                        }\n                    },\n                    {\n                        \"InputName\": \"code\",\n                        \"AppManaged\": false,\n                        \"S3Input\": {\n                            \"S3Uri\": \"s3://mlops-us-east-2-<AccountId>/ETL-ffced94c22a61ea46a8b03cdaece117b/input/code/preprocessing.py\",\n                            \"LocalPath\": \"/opt/ml/processing/input/code\",\n                            \"S3DataType\": \"S3Prefix\",\n                            \"S3InputMode\": \"File\",\n                            \"S3DataDistributionType\": \"FullyReplicated\",\n                            \"S3CompressionType\": \"None\"\n                        }\n                    }\n                ],\n                \"ProcessingOutputConfig\": {\n                    \"Outputs\": [\n                        {\n                            \"OutputName\": \"train\",\n                            \"AppManaged\": false,\n                            \"S3Output\": {\n                                \"S3Uri\": {\n                                    \"Std:Join\": {\n                                        \"On\": \"/\",\n                                        \"Values\": [\n                                            \"s3:/\",\n                                            {\n                                                \"Get\": \"Parameters.mlops_bucket\"\n                                            },\n                                            {\n                                                \"Get\": \"Execution.PipelineName\"\n                                            },\n                                            {\n                                                \"Get\": \"Execution.PipelineExecutionId\"\n                                            },\n                                            \"input/train\"\n                                        ]\n                                    }\n                                },\n                                \"LocalPath\": \"/opt/ml/processing/train\",\n                                \"S3UploadMode\": \"EndOfJob\"\n                            }\n                        },\n                        {\n                            \"OutputName\": \"test\",\n                            \"AppManaged\": false,\n                            \"S3Output\": {\n                                \"S3Uri\": {\n                                    \"Std:Join\": {\n                                        \"On\": \"/\",\n                                        \"Values\": [\n                                            \"s3:/\",\n                                            {\n                                                \"Get\": \"Parameters.mlops_bucket\"\n                                            },\n                                            {\n                                                \"Get\": \"Execution.PipelineName\"\n                                            },\n                                            {\n                                                \"Get\": \"Execution.PipelineExecutionId\"\n                                            },\n                                            \"input/test\"\n                                        ]\n                                    }\n                                },\n                                \"LocalPath\": \"/opt/ml/processing/test\",\n                                \"S3UploadMode\": \"EndOfJob\"\n                            }\n                        }\n                    ]\n                }\n            }\n        },\n        {\n            \"Name\": \"Train\",\n            \"Type\": \"Training\",\n            \"Arguments\": {\n                \"AlgorithmSpecification\": {\n                    \"TrainingInputMode\": \"File\",\n                    \"TrainingImage\": \"<AccountId>.dkr.ecr.us-east-2.amazonaws.com/abalone:latest\"\n                },\n                \"OutputDataConfig\": {\n                    \"S3OutputPath\": {\n                        \"Std:Join\": {\n                            \"On\": \"/\",\n                            \"Values\": [\n                                \"s3:/\",\n                                {\n                                    \"Get\": \"Parameters.mlops_bucket\"\n                                },\n                                {\n                                    \"Get\": \"Execution.PipelineName\"\n                                },\n                                {\n                                    \"Get\": \"Execution.PipelineExecutionId\"\n                                },\n                                \"output\"\n                            ]\n                        }\n                    }\n                },\n                \"StoppingCondition\": {\n                    \"MaxRuntimeInSeconds\": 86400\n                },\n                \"ResourceConfig\": {\n                    \"VolumeSizeInGB\": 30,\n                    \"InstanceCount\": {\n                        \"Get\": \"Parameters.TrainingInstanceCount\"\n                    },\n                    \"InstanceType\": \"ml.m5.xlarge\"\n                },\n                \"RoleArn\": \"arn:aws:iam::<AccountId>:role/service-role/AmazonSageMaker-ExecutionRole-20221004T094906\",\n                \"InputDataConfig\": [\n                    {\n                        \"DataSource\": {\n                            \"S3DataSource\": {\n                                \"S3DataType\": \"S3Prefix\",\n                                \"S3Uri\": {\n                                    \"Get\": \"Steps.ETL.ProcessingOutputConfig.Outputs['train'].S3Output.S3Uri\"\n                                },\n                                \"S3DataDistributionType\": \"FullyReplicated\"\n                            }\n                        },\n                        \"ContentType\": \"text/csv\",\n                        \"ChannelName\": \"training\"\n                    }\n                ],\n                \"HyperParameters\": {\n                    \"epochs\": \"2000\",\n                    \"layers\": \"2\",\n                    \"dense_layer\": \"64\",\n                    \"batch_size\": \"8\"\n                },\n                \"DebugHookConfig\": {\n                    \"S3OutputPath\": {\n                        \"Std:Join\": {\n                            \"On\": \"/\",\n                            \"Values\": [\n                                \"s3:/\",\n                                {\n                                    \"Get\": \"Parameters.mlops_bucket\"\n                                },\n                                {\n                                    \"Get\": \"Execution.PipelineName\"\n                                },\n                                {\n                                    \"Get\": \"Execution.PipelineExecutionId\"\n                                },\n                                \"output\"\n                            ]\n                        }\n                    },\n                    \"CollectionConfigurations\": []\n                },\n                \"ProfilerRuleConfigurations\": [\n                    {\n                        \"RuleConfigurationName\": \"ProfilerReport-1664988159\",\n                        \"RuleEvaluatorImage\": \"915447279597.dkr.ecr.us-east-2.amazonaws.com/sagemaker-debugger-rules:latest\",\n                        \"RuleParameters\": {\n                            \"rule_to_invoke\": \"ProfilerReport\"\n                        }\n                    }\n                ],\n                \"ProfilerConfig\": {\n                    \"S3OutputPath\": {\n                        \"Std:Join\": {\n                            \"On\": \"/\",\n                            \"Values\": [\n                                \"s3:/\",\n                                {\n                                    \"Get\": \"Parameters.mlops_bucket\"\n                                },\n                                {\n                                    \"Get\": \"Execution.PipelineName\"\n                                },\n                                {\n                                    \"Get\": \"Execution.PipelineExecutionId\"\n                                },\n                                \"output\"\n                            ]\n                        }\n                    }\n                }\n            }\n        },\n        {\n            \"Name\": \"Evaluate\",\n            \"Type\": \"Processing\",\n            \"Arguments\": {\n                \"ProcessingResources\": {\n                    \"ClusterConfig\": {\n                        \"InstanceType\": \"ml.m5.xlarge\",\n                        \"InstanceCount\": {\n                            \"Get\": \"Parameters.ProcessingInstanceCount\"\n                        },\n                        \"VolumeSizeInGB\": 30\n                    }\n                },\n                \"AppSpecification\": {\n                    \"ImageUri\": \"<AccountId>.dkr.ecr.us-east-2.amazonaws.com/abalone:latest\",\n                    \"ContainerEntrypoint\": [\n                        \"python3\",\n                        \"/opt/ml/processing/input/code/evaluation.py\"\n                    ]\n                },\n                \"RoleArn\": \"arn:aws:iam::<AccountId>:role/service-role/AmazonSageMaker-ExecutionRole-20221004T094906\",\n                \"ProcessingInputs\": [\n                    {\n                        \"InputName\": \"input-1\",\n                        \"AppManaged\": false,\n                        \"S3Input\": {\n                            \"S3Uri\": {\n                                \"Get\": \"Steps.Train.ModelArtifacts.S3ModelArtifacts\"\n                            },\n                            \"LocalPath\": \"/opt/ml/processing/input/model\",\n                            \"S3DataType\": \"S3Prefix\",\n                            \"S3InputMode\": \"File\",\n                            \"S3DataDistributionType\": \"FullyReplicated\",\n                            \"S3CompressionType\": \"None\"\n                        }\n                    },\n                    {\n                        \"InputName\": \"input-2\",\n                        \"AppManaged\": false,\n                        \"S3Input\": {\n                            \"S3Uri\": {\n                                \"Get\": \"Steps.ETL.ProcessingOutputConfig.Outputs['test'].S3Output.S3Uri\"\n                            },\n                            \"LocalPath\": \"/opt/ml/processing/input/testing\",\n                            \"S3DataType\": \"S3Prefix\",\n                            \"S3InputMode\": \"File\",\n                            \"S3DataDistributionType\": \"FullyReplicated\",\n                            \"S3CompressionType\": \"None\"\n                        }\n                    },\n                    {\n                        \"InputName\": \"code\",\n                        \"AppManaged\": false,\n                        \"S3Input\": {\n                            \"S3Uri\": \"s3://sagemaker-us-east-2-<AccountId>/Evaluate-82aac12ac3c6908d30720b5fac9240a1/input/code/evaluation.py\",\n                            \"LocalPath\": \"/opt/ml/processing/input/code\",\n                            \"S3DataType\": \"S3Prefix\",\n                            \"S3InputMode\": \"File\",\n                            \"S3DataDistributionType\": \"FullyReplicated\",\n                            \"S3CompressionType\": \"None\"\n                        }\n                    }\n                ],\n                \"ProcessingOutputConfig\": {\n                    \"Outputs\": [\n                        {\n                            \"OutputName\": \"evaluation\",\n                            \"AppManaged\": false,\n                            \"S3Output\": {\n                                \"S3Uri\": {\n                                    \"Std:Join\": {\n                                        \"On\": \"/\",\n                                        \"Values\": [\n                                            \"s3:/\",\n                                            {\n                                                \"Get\": \"Parameters.mlops_bucket\"\n                                            },\n                                            {\n                                                \"Get\": \"Execution.PipelineName\"\n                                            },\n                                            {\n                                                \"Get\": \"Execution.PipelineExecutionId\"\n                                            },\n                                            \"evaluation\"\n                                        ]\n                                    }\n                                },\n                                \"LocalPath\": \"/opt/ml/processing/output/evaluation\",\n                                \"S3UploadMode\": \"EndOfJob\"\n                            }\n                        }\n                    ]\n                }\n            },\n            \"PropertyFiles\": [\n                {\n                    \"PropertyFileName\": \"EvaluationReport\",\n                    \"OutputName\": \"evaluation\",\n                    \"FilePath\": \"evaluation.json\"\n                }\n            ]\n        },\n        {\n            \"Name\": \"Condition\",\n            \"Type\": \"Condition\",\n            \"Arguments\": {\n                \"Conditions\": [\n                    {\n                        \"Type\": \"LessThanOrEqualTo\",\n                        \"LeftValue\": {\n                            \"Std:JsonGet\": {\n                                \"PropertyFile\": {\n                                    \"Get\": \"Steps.Evaluate.PropertyFiles.EvaluationReport\"\n                                },\n                                \"Path\": \"regression_metrics.mse.value\"\n                            }\n                        },\n                        \"RightValue\": 6.0\n                    }\n                ],\n                \"IfSteps\": [\n                    {\n                        \"Name\": \"Register-RegisterModel\",\n                        \"Type\": \"RegisterModel\",\n                        \"Arguments\": {\n                            \"ModelPackageGroupName\": \"AbalonePackageGroup\",\n                            \"ModelMetrics\": {\n                                \"ModelQuality\": {\n                                    \"Statistics\": {\n                                        \"ContentType\": \"application/json\",\n                                        \"S3Uri\": {\n                                            \"Std:Join\": {\n                                                \"On\": \"/\",\n                                                \"Values\": [\n                                                    \"s3:/\",\n                                                    {\n                                                        \"Get\": \"Parameters.mlops_bucket\"\n                                                    },\n                                                    {\n                                                        \"Get\": \"Execution.PipelineName\"\n                                                    },\n                                                    {\n                                                        \"Get\": \"Execution.PipelineExecutionId\"\n                                                    },\n                                                    \"evaluation/evaluation.json\"\n                                                ]\n                                            }\n                                        }\n                                    }\n                                },\n                                \"Bias\": {},\n                                \"Explainability\": {}\n                            },\n                            \"InferenceSpecification\": {\n                                \"Containers\": [\n                                    {\n                                        \"Image\": \"<AccountId>.dkr.ecr.us-east-2.amazonaws.com/abalone:latest\",\n                                        \"ModelDataUrl\": {\n                                            \"Get\": \"Steps.Train.ModelArtifacts.S3ModelArtifacts\"\n                                        }\n                                    }\n                                ],\n                                \"SupportedContentTypes\": [\n                                    \"text/csv\"\n                                ],\n                                \"SupportedResponseMIMETypes\": [\n                                    \"text/csv\"\n                                ],\n                                \"SupportedRealtimeInferenceInstanceTypes\": [\n                                    \"ml.t2.medium\",\n                                    \"ml.m5.xlarge\",\n                                    \"ml.c5.large\"\n                                ],\n                                \"SupportedTransformInstanceTypes\": [\n                                    \"ml.m5.xlarge\"\n                                ]\n                            },\n                            \"ModelApprovalStatus\": {\n                                \"Get\": \"Parameters.ModelApprovalStatus\"\n                            }\n                        }\n                    }\n                ],\n                \"ElseSteps\": [\n                    {\n                        \"Name\": \"Fail\",\n                        \"Type\": \"Fail\",\n                        \"Arguments\": {\n                            \"ErrorMessage\": {\n                                \"Std:Join\": {\n                                    \"On\": \" \",\n                                    \"Values\": [\n                                        \"Execution failed due to MSE greater than\",\n                                        {\n                                            \"Get\": \"Parameters.MseThreshold\"\n                                        }\n                                    ]\n                                }\n                            }\n                        }\n                    }\n                ]\n            }\n        }\n    ]\n}"